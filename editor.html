<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HD Image Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdn.jsdelivr.net/npm/upscaler@1.8.0/dist/upscaler.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .container { max-width: 100%; margin: auto; display: flex; flex-direction: column; align-items: center; }
        .editor-container { width: 100%; max-width: 1920px; height: auto; max-height: 1080px; overflow: hidden; display: flex; justify-content: center; align-items: center; position: relative; }
        .editor-container img { width: auto; height: auto; max-width: 100%; max-height: 100%; display: block; object-fit: contain; }
        canvas { display: none; }
        .btn-container { margin-top: 10px; }
        button, select, input { padding: 8px 16px; margin: 5px; font-size: 16px; cursor: pointer; }
        input[type="number"] { width: 100px; }
        .preview-container { margin-top: 20px; display: flex; justify-content: center; overflow: hidden; }
        .preview-container img { max-width: 100%; display: block; object-fit: contain; }
    </style>
</head>
<body>

    <h1>HD Image Editor (Responsive Preview with AI Upscaling)</h1>
    <div class="container">
        <p><strong>Original Size:</strong> <span id="originalSize">Loading...</span></p>
        <div class="editor-container" id="editorContainer">
            <img id="image" src="" alt="Image to Edit">
        </div>
        <canvas id="canvas"></canvas>
    </div>

    <!-- Custom Resize Inputs -->
    <div class="btn-container">
        <label for="customWidth">Custom Width:</label>
        <input type="number" id="customWidth" placeholder="Enter width (px)">
        
        <label for="customHeight">Custom Height:</label>
        <input type="number" id="customHeight" placeholder="Enter height (px)">
        
        <button id="applySizeBtn">Apply Size</button>
    </div>

    <div class="btn-container">
        <button id="cropBtn">Crop & Resize</button>
        <button id="downloadBtn" style="display: none;">Download Image</button>
    </div>

    <div class="preview-container">
        <h2>Preview:</h2>
        <img id="preview" style="display: none;">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const imageUrl = urlParams.get('image');
        const image = document.getElementById('image');
        const editorContainer = document.getElementById('editorContainer');
        const originalSizeDisplay = document.getElementById('originalSize');
        const previewImage = document.getElementById('preview');

        if (imageUrl) {
            image.src = decodeURIComponent(imageUrl);
        }

        let cropper;
        image.onload = function () {
            let originalWidth = image.naturalWidth;
            let originalHeight = image.naturalHeight;

            originalSizeDisplay.textContent = `${originalWidth} x ${originalHeight} px`;
            
            let maxWidth = 1920;
            let maxHeight = 1080;
            let scaleRatio = Math.min(maxWidth / originalWidth, maxHeight / originalHeight, 1);
            let displayWidth = originalWidth * scaleRatio;
            let displayHeight = originalHeight * scaleRatio;
            
            editorContainer.style.width = `${displayWidth}px`;
            editorContainer.style.height = `${displayHeight}px`;
            image.style.width = `${displayWidth}px`;
            image.style.height = `${displayHeight}px`;

            cropper = new Cropper(image, {
                aspectRatio: NaN,
                viewMode: 1,
                autoCropArea: 1,
                responsive: true,
                zoomable: true,
            });
        };

        document.getElementById('applySizeBtn').addEventListener('click', function () {
            const customWidth = parseInt(document.getElementById('customWidth').value);
            const customHeight = parseInt(document.getElementById('customHeight').value);

            if (customWidth > 0 && customHeight > 0) {
                cropper.setCropBoxData({
                    width: customWidth,
                    height: customHeight
                });
            }
        });

        document.getElementById('cropBtn').addEventListener('click', async function () {
            const inputWidth = parseInt(document.getElementById('customWidth').value);
            const inputHeight = parseInt(document.getElementById('customHeight').value);

            const croppedCanvas = cropper.getCroppedCanvas();

            if (croppedCanvas && inputWidth > 0 && inputHeight > 0) {
                const base64Image = croppedCanvas.toDataURL('image/png');
                const imgElement = new Image();

                imgElement.onload = async () => {
                    const upscaler = new Upscaler();
                    const upscaledBase64 = await upscaler.upscale(imgElement, {
                        scale: 1, // We'll resize manually after
                        output: 'base64'
                    });

                    const finalImg = new Image();
                    finalImg.onload = () => {
                        const finalCanvas = document.createElement('canvas');
                        finalCanvas.width = inputWidth;
                        finalCanvas.height = inputHeight;
                        const ctx = finalCanvas.getContext('2d');
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                        ctx.drawImage(finalImg, 0, 0, inputWidth, inputHeight);

                        previewImage.src = finalCanvas.toDataURL('image/png');
                        previewImage.style.display = 'block';

                        document.getElementById('downloadBtn').style.display = 'inline-block';
                        document.getElementById('downloadBtn').onclick = function () {
                            const link = document.createElement('a');
                            link.download = 'cropped-image.png';
                            link.href = finalCanvas.toDataURL('image/png');
                            link.click();
                        };
                    };
                    finalImg.src = upscaledBase64;
                };
                imgElement.src = base64Image;
            }
        });
    </script>
</body>
</html>

