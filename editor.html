<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .container { max-width: 80%; margin: auto; }
        img { max-width: 100%; }
        canvas { display: none; }
        .btn-container { margin-top: 10px; }
        button, select { padding: 8px 16px; margin: 5px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>Image Editor</h1>
    <div class="container">
        <img id="image" src="" alt="Image to Edit">
        <canvas id="canvas"></canvas>
    </div>

    <!-- Aspect Ratio & Size Selection -->
    <div class="btn-container">
        <label for="aspectRatio">Aspect Ratio:</label>
        <select id="aspectRatio">
            <option value="NaN">Freeform</option>
            <option value="16/9">Landscape (16:9)</option>
            <option value="4/3">Standard (4:3)</option>
            <option value="1">Square (1:1)</option>
            <option value="3/4">Portrait (3:4)</option>
        </select>

        <label for="imageSize">Resize:</label>
        <select id="imageSize">
            <option value="original">Original</option>
            <option value="800">Large (800px wide)</option>
            <option value="500">Medium (500px wide)</option>
            <option value="300">Small (300px wide)</option>
        </select>
    </div>

    <div class="btn-container">
        <button id="cropBtn">Crop Image</button>
        <button id="downloadBtn" style="display: none;">Download Image</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script>
        // Get image URL from query parameter
        const urlParams = new URLSearchParams(window.location.search);
        const imageUrl = urlParams.get('image');
        const image = document.getElementById('image');

        if (imageUrl) {
            image.src = decodeURIComponent(imageUrl);
        }

        // Initialize Cropper.js
        let cropper;
        image.onload = function () {
            cropper = new Cropper(image, {
                aspectRatio: NaN, // Default to Freeform
                viewMode: 1,
                autoCropArea: 1,
            });
        };

        // Handle Aspect Ratio Change
        document.getElementById('aspectRatio').addEventListener('change', function () {
            const newRatio = parseFloat(this.value);
            cropper.setAspectRatio(newRatio);
        });

        // Crop & Download
        document.getElementById('cropBtn').addEventListener('click', function () {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                // Resize based on user selection
                const sizeOption = document.getElementById('imageSize').value;
                let width = canvas.width;
                if (sizeOption !== "original") {
                    width = parseInt(sizeOption);
                }

                const resizedCanvas = document.createElement('canvas');
                const ctx = resizedCanvas.getContext('2d');
                const scale = width / canvas.width;
                resizedCanvas.width = width;
                resizedCanvas.height = canvas.height * scale;
                ctx.drawImage(canvas, 0, 0, resizedCanvas.width, resizedCanvas.height);

                // Show Download Button
                document.getElementById('downloadBtn').style.display = 'inline-block';
                document.getElementById('downloadBtn').onclick = function () {
                    const link = document.createElement('a');
                    link.download = 'cropped-image.png';
                    link.href = resizedCanvas.toDataURL('image/png');
                    link.click();
                };
            }
        });
    </script>

</body>
</html>
