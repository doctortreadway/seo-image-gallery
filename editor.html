<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HD Image Editor (Pica Edition)</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <script src="https://unpkg.com/pica@8.0.0/dist/pica.min.js"></script>

  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
    .container, .btn-container, .preview-container { margin-top: 10px; }
    canvas { display: none; }
    img { max-width: 100%; height: auto; }
    button { margin: 5px; padding: 10px 15px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>HD Image Editor (Fast Client-side Upscaling)</h1>
  <p><strong>Original Size:</strong> <span id="originalSize">Loading...</span></p>
  <div class="container">
    <img id="image" alt="Image to Edit" />
  </div>

  <div class="btn-container">
    <button class="upscaleBtn">Upscale to 1920x1080</button>
  </div>

  <div class="btn-container">
    <label for="customWidth">Width:</label>
    <input type="number" id="customWidth" placeholder="Width (px)" />
    <label for="customHeight">Height:</label>
    <input type="number" id="customHeight" placeholder="Height (px)" />
    <button id="processImageBtn">Resize</button>
  </div>

  <div class="btn-container">
    <button id="downloadBtn" style="display:none;">Download Image</button>
  </div>

  <div class="preview-container">
    <h2>Preview:</h2>
    <img id="preview" style="display:none;" />
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const imageUrl = urlParams.get('image');
    const image = document.getElementById('image');
    const originalSizeDisplay = document.getElementById('originalSize');
    const previewImage = document.getElementById('preview');
    const picaInstance = window.pica();
    let cropper;

    if (imageUrl) {
      const proxyBase = "https://image-proxy-5u7f.onrender.com/image?url=";
      image.crossOrigin = "anonymous";
      image.src = proxyBase + encodeURIComponent(imageUrl);
    }

    image.onload = () => {
      originalSizeDisplay.textContent = `${image.naturalWidth} x ${image.naturalHeight}px`;
      cropper = new Cropper(image, {
        viewMode: 1,
        autoCropArea: 1,
        responsive: true
      });
    };

    document.querySelector('.upscaleBtn').addEventListener('click', async () => {
      const cropCanvas = cropper.getCroppedCanvas();
      const upscaleCanvas = document.createElement('canvas');
      upscaleCanvas.width = 1920;
      upscaleCanvas.height = 1080;
      await picaInstance.resize(cropCanvas, upscaleCanvas);
      previewImage.src = upscaleCanvas.toDataURL();
      previewImage.style.display = 'block';
      showDownload(previewImage.src);
    });

    document.getElementById('processImageBtn').addEventListener('click', async () => {
      const width = parseInt(document.getElementById('customWidth').value);
      const height = parseInt(document.getElementById('customHeight').value);
      if (!width || !height) return;

      const cropCanvas = cropper.getCroppedCanvas();
      const finalCanvas = document.createElement('canvas');
      finalCanvas.width = width;
      finalCanvas.height = height;
      await picaInstance.resize(cropCanvas, finalCanvas);
      previewImage.src = finalCanvas.toDataURL();
      previewImage.style.display = 'block';
      showDownload(previewImage.src);
    });

    function showDownload(dataUrl) {
      const downloadBtn = document.getElementById('downloadBtn');
      downloadBtn.style.display = 'inline-block';
      downloadBtn.onclick = () => {
        const link = document.createElement('a');
        link.download = 'edited-image.png';
        link.href = dataUrl;
        link.click();
      };
    }
  </script>
</body>
</html>




