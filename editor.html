<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HD Image Editor (Pica Edition)</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <script src="https://unpkg.com/pica@8.0.0/dist/pica.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    .outer-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 20px;
    }

    .editor-container {
      max-width: 90vw;
      max-height: 80vh;
      overflow: auto;
      display: flex;
      justify-content: center;
      align-items: center;
      border: 1px solid #ccc;
      background: #f9f9f9;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 20px;
    }

    .editor-container img {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      display: block;
    }

    .btn-container {
      margin: 10px 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    button, input[type="number"] {
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
    }

    .preview-wrapper {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-top: 40px;
      border-top: 1px solid #eee;
      padding-top: 20px;
    }

    .preview-container {
      padding: 20px;
      border: 2px dashed #ccc;
      background-color: #f9f9f9;
      max-width: 1000px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .preview-container h2 {
      margin-bottom: 10px;
      font-size: 18px;
      color: #333;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-align: center;
    }

    .preview-container img {
      max-width: 100%;
      height: auto;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: white;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <div class="outer-wrapper">
    <h1>HD Image Editor (Fast Client-side Upscaling)</h1>
    <p><strong>Original Size:</strong> <span id="originalSize">Loading...</span></p>

    <div class="editor-container">
      <img id="image" alt="Image to Edit" />
    </div>

    <div class="btn-container">
      <button class="upscaleBtn">Upscale to 1920x1080</button>
    </div>

    <div class="btn-container">
      <label for="customWidth">Width:</label>
      <input type="number" id="customWidth" placeholder="Width (px)" />
      <label for="customHeight">Height:</label>
      <input type="number" id="customHeight" placeholder="Height (px)" />
      <button id="processImageBtn">Resize</button>
    </div>

    <div class="btn-container">
      <button id="downloadBtn" style="display:none;">Download Image</button>
    </div>

    <div class="preview-wrapper">
      <div class="preview-container">
        <h2>Preview:</h2>
        <img id="preview" style="display:none;" />
      </div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const imageUrl = urlParams.get('image');
    const image = document.getElementById('image');
    const originalSizeDisplay = document.getElementById('originalSize');
    const previewImage = document.getElementById('preview');
    const picaInstance = window.pica();
    let cropper;

    const proxyBase = "https://image-proxy-nc1w.onrender.com/image?url=";

    if (imageUrl) {
      image.crossOrigin = "anonymous";
      image.src = proxyBase + encodeURIComponent(imageUrl);
    }

    image.onload = () => {
      originalSizeDisplay.textContent = `${image.naturalWidth} x ${image.naturalHeight}px`;
      cropper = new Cropper(image, {
        viewMode: 1,
        autoCropArea: 1,
        responsive: true
      });
    };

    document.querySelector('.upscaleBtn').addEventListener('click', async () => {
      const cropCanvas = cropper.getCroppedCanvas();
      const upscaleCanvas = document.createElement('canvas');
      upscaleCanvas.width = 1920;
      upscaleCanvas.height = 1080;
      await picaInstance.resize(cropCanvas, upscaleCanvas);
      previewImage.src = upscaleCanvas.toDataURL();
      previewImage.style.display = 'block';
      showDownload(previewImage.src);
    });

    document.getElementById('processImageBtn').addEventListener('click', async () => {
      const width = parseInt(document.getElementById('customWidth').value);
      const height = parseInt(document.getElementById('customHeight').value);
      if (!width || !height) return;

      const cropCanvas = cropper.getCroppedCanvas();
      const finalCanvas = document.createElement('canvas');
      finalCanvas.width = width;
      finalCanvas.height = height;
      await picaInstance.resize(cropCanvas, finalCanvas);
      previewImage.src = finalCanvas.toDataURL();
      previewImage.style.display = 'block';
      showDownload(previewImage.src);
    });

    function showDownload(dataUrl) {
      const downloadBtn = document.getElementById('downloadBtn');
      downloadBtn.style.display = 'inline-block';
      downloadBtn.onclick = () => {
        const link = document.createElement('a');
        link.download = 'edited-image.png';
        link.href = dataUrl;
        link.click();
      };
    }
    const params = new URLSearchParams(window.location.search);
    const creator = params.get('by') || 'Unknown';
    const source = params.get('source') || 'Unknown';

    const creditText = `ðŸ“¸ Image by ${creator} via ${source}`;
    const creditBox = document.createElement('div');
    creditBox.textContent = creditText;
    creditBox.style.fontSize = '14px';
    creditBox.style.color = '#555';
    creditBox.style.marginTop = '10px';
    creditBox.style.textAlign = 'center';

    const previewContainer = document.querySelector('.preview-container');
    previewContainer.appendChild(creditBox);

    
  </script>
</body>
</html>

